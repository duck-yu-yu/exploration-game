<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8"><!-- æ–‡ä»¶ç·¨ç¢¼ -->
  <title>æ¢ç´¢åœ°åœ– | åœ–é‘‘å†’éšª</title><!-- é é¢æ¨™é¡Œ -->
  <style>
    body {
      background-color: #111;
      color: #0f0;
      font-family: monospace;
      text-align: center;
      padding: 20px;
    }
    .map {
      display: grid;
      grid-template-columns: repeat(10, 40px);
      grid-gap: 5px;
      justify-content: center;
      margin-bottom: 20px;
    }
    .tile {
      width: 40px;
      height: 40px;
      background-color: #222;
      color: #fff;
      font-size: 20px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s, color 0.3s;
    }
    .tile:hover {
      background-color: #0f0;
      color: #000;
    }
    #dex, #card, #progress-container {
      margin-top: 20px;
      border: 1px solid #0f0;
      padding: 10px;
      background-color: #000;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
    .glow {
      animation: glow 1s infinite alternate;
    }
    @keyframes glow {
      from { text-shadow: 0 0 5px #0f0; }
      to { text-shadow: 0 0 20px #0f0; }
    }
    .progress-bar {
      width: 100%;
      background-color: #333;
      border: 1px solid #0f0;
      height: 20px;
      margin-top: 5px;
    }
    .progress-fill {
      height: 100%;
      background-color: #0f0;
      width: 0%;
      transition: width 0.5s ease;
    }
    .rare { color: gold; }
    .epic { color: deepskyblue; }
    .legendary { color: orchid; font-weight: bold; }
  </style>
</head>
<body>
  <h2>ğŸŒ æ¢ç´¢ä¸–ç•Œ & æ”¶é›†åœ–é‘‘</h2>
  <p>é»æ“Šåœ°åœ–ä¸Šçš„ç”Ÿç‰©ä»¥è§£é–ç‰ å€‘çš„åœ–é‘‘è³‡æ–™ï¼</p>
  <div class="map" id="map"></div>
  <div id="progress-container">
    <div>åœ–é‘‘å®Œæˆåº¦ï¼š<span id="progress-percent">0%</span></div>
    <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
  </div>
  <h3>ğŸ“˜ å·²ç™¼ç¾ç”Ÿç‰©åœ–é‘‘</h3>
  <div id="dex">å°šæœªç™¼ç¾ä»»ä½•ç”Ÿç‰©...</div>
  <h3>ğŸ“‡ ç”Ÿç‰©ä»‹ç´¹å¡</h3>
  <div id="card">é»æ“Šåœ–é‘‘ä¸­çš„ç”Ÿç‰©ä»¥æŸ¥çœ‹ä»‹ç´¹å¡ã€‚</div>

  <script>
    const rareEffect = new Audio("https://cdn.pixabay.com/audio/2022/03/10/audio_1a0b4e44e3.mp3"); // ç¨€æœ‰éŸ³æ•ˆ
    const evoSound = new Audio("https://cdn.pixabay.com/audio/2021/12/20/audio_f297b74f26.mp3"); // é€²åŒ–éŸ³æ•ˆ
    const megaSound = new Audio("https://cdn.pixabay.com/audio/2022/02/08/audio_74cc1c7207.mp3"); // è¶…é€²åŒ–éŸ³æ•ˆ
    const sparkSound = new Audio("https://cdn.pixabay.com/audio/2022/03/11/audio_9cde7b8d67.mp3"); // ç«èŠ±éŸ³æ•ˆ

    // ç”Ÿç‰©è³‡æ–™
    const creatures = [
      { name: "ç«å…‰æ¾é¼ ", emoji: "ğŸ¿", rarity: "rare", seenCount: 0,
        sound: "https://cdn.pixabay.com/audio/2022/03/15/audio_6a66d56b9f.mp3",
        evolution: { name: "ç«å…‰é¼ ç‹", emoji: "ğŸ¦«" },
        mega: { name: "ç†”å²©ä¹‹å°¾ - è¶…ç«æ¾ç‹", emoji: "ğŸ¦¥" } },

      { name: "æ³¡æ³¡è›™", emoji: "ğŸ¸", rarity: "epic", seenCount: 0,
        sound: "https://cdn.pixabay.com/audio/2022/03/15/audio_d9aee9fe3a.mp3",
        evolution: { name: "æ³¡æ³¡æš´è›™", emoji: "ğŸ¦" },
        mega: { name: "æ°´å£“çµ‚çµè€… - æš´æ³¡ç¥", emoji: "ğŸŠ" } },

      { name: "åˆºåˆºè˜‘è‡ç¸", emoji: "ğŸ„", rarity: "rare", seenCount: 0,
        sound: "https://cdn.pixabay.com/audio/2021/09/14/audio_a4f6f1863b.mp3",
        evolution: { name: "åŠ‡æ¯’è˜‘çš‡", emoji: "ğŸŒµ" },
        mega: { name: "çœŸèŒæ ¸ç½ç¸", emoji: "ğŸ’€" } },

      { name: "é–ƒé›»è²“", emoji: "ğŸˆ", rarity: "epic", seenCount: 0,
        sound: "https://cdn.pixabay.com/audio/2021/11/25/audio_1c14fcf388.mp3",
        evolution: { name: "é›·å…‰ç¸", emoji: "ğŸ¦" },
        mega: { name: "å¤©é›·çˆ†è£‚è²“çš‡", emoji: "âš¡" } },

      { name: "å¤œå…‰ç‹", emoji: "ğŸ¦Š", rarity: "legendary", seenCount: 0,
        sound: "https://cdn.pixabay.com/audio/2022/03/15/audio_23bca1a792.mp3",
        evolution: { name: "å¹»å½±éˆç‹", emoji: "ğŸ¦" },
        mega: { name: "å†¥ç•Œæœˆå½±ç‹", emoji: "ğŸŒ‘" } },

      { name: "é£›å¤©æ©˜å­é³¥", emoji: "ğŸ¦œ", rarity: "legendary", seenCount: 0,
        sound: "https://cdn.pixabay.com/audio/2022/03/15/audio_f6550a49a2.mp3",
        evolution: { name: "å·¨æ©˜ç¿”é·¹", emoji: "ğŸ¦…" },
        mega: { name: "å¤©ç©ºæœç¥ - é£›æ©˜ç‹", emoji: "ğŸŠ" } },
    ];

    const seen = new Set(); // ç´€éŒ„å·²ç™¼ç¾ç”Ÿç‰©
    const exploredTiles = new Set(); // ç´€éŒ„å·²æ¢ç´¢æ ¼å­

    const mapDiv = document.getElementById("map"); // åœ°åœ–å®¹å™¨
    const dexDiv = document.getElementById("dex"); // åœ–é‘‘æ¸…å–®å®¹å™¨
    const cardDiv = document.getElementById("card"); // ç”Ÿç‰©ä»‹ç´¹å¡å®¹å™¨
    const progressPercent = document.getElementById("progress-percent"); // é€²åº¦ç™¾åˆ†æ¯”
    const progressFill = document.getElementById("progress-fill"); // é€²åº¦æ¢å¡«å……

    let creaturePositions = []; // ç´€éŒ„æ€ªç‰©åœ¨åœ°åœ–ä¸Šçš„æ ¼å­ç´¢å¼•

    // æ’­æ”¾æŒ‡å®šéŸ³æ•ˆ
    function playSound(src) {
      const audio = new Audio(src);
      audio.play();
    }

    // èªéŸ³æ’­å ±æ–‡å­—
    function speak(text) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'zh-TW';
      window.speechSynthesis.speak(utter);
    }

    // æ›´æ–°é€²åº¦æ¢å’Œç™¾åˆ†æ¯”
    function updateProgress() {
      const percent = Math.floor((seen.size / creatures.length) * 100);
      progressPercent.textContent = `${percent}%`;
      progressFill.style.width = `${percent}%`;
    }

    // æ›´æ–°åœ–é‘‘æ¸…å–®
    function updateDex() {
      if (seen.size === 0) {
        dexDiv.textContent = "å°šæœªç™¼ç¾ä»»ä½•ç”Ÿç‰©...";
        return;
      }
      dexDiv.innerHTML = "<ul>" + [...seen].map(name => {
        const c = creatures.find(c => c.name === name);
        return `<li class="${c.rarity}" style="cursor:pointer;" onclick="showCard('${c.name}')">${c.emoji} ${c.name}</li>`;
      }).join("") + "</ul>";
    }

    // é¡¯ç¤ºç”Ÿç‰©ä»‹ç´¹å¡
    function showCard(name) {
      const c = creatures.find(c => c.name === name);
      if (!c) return;
      playSound(c.sound);
      evoSound.play();
      sparkSound.play();
      speak(`${c.name} çš„é€²åŒ–æ˜¯ ${c.evolution.name}ï¼Œè¶…é€²åŒ–æ˜¯ ${c.mega.name}`);

      const canMega = c.seenCount >= 3 && exploredTiles.size >= 15;

      const megaHTML = canMega ?
        `<span class="glow" style="cursor:pointer;" onclick="showForm('${c.mega.name}', '${c.mega.emoji}', 'mega')">è¶…é€²åŒ–å‹æ…‹ï¼š${c.mega.emoji} ${c.mega.name}</span>`
        : `<em>éœ€é‡éä¸‰æ¬¡ä¸”æ¢ç´¢è¶…é 15 æ ¼æ‰èƒ½è§£é–è¶…é€²åŒ–</em>`;

      cardDiv.innerHTML = `
        <h4 class="glow">${c.emoji} ${c.name}</h4>
        <p class="glow" style="cursor:pointer;" onclick="showForm('${c.evolution.name}', '${c.evolution.emoji}', 'evolution')">
          é€²åŒ–å‹æ…‹ï¼š${c.evolution.emoji} ${c.evolution.name}</p>
        <p>${megaHTML}</p>
      `;
    }

    // é¡¯ç¤ºé€²åŒ–èªªæ˜å½ˆçª—
    function showForm(name, emoji, type) {
      const info = type === 'mega' ? "é€™æ˜¯æœ€çµ‚å‹æ…‹ï¼Œæ“æœ‰å‚³èªªç´šåŠ›é‡ï¼" : "é€™æ˜¯æ™®é€šé€²åŒ–å‹ï¼Œå¯æå‡èƒ½åŠ›å€¼ã€‚";
      speak(`${name}ï¼š${info}`);
      alert(`${emoji} ${name}ï¼š\n${info}`);
    }

    // ç”¢ç”Ÿä¸¦æ¸²æŸ“åœ°åœ–ï¼Œéš¨æ©Ÿé…ç½®æ€ªç‰©
    function generateMap() {
      mapDiv.innerHTML = "";       // æ¸…ç©ºåœ°åœ–å…§å®¹
      creaturePositions = [];      // é‡ç½®æ€ªç‰©ä½ç½®é™£åˆ—

      for (let i = 0; i < 100; i++) {
        const tile = document.createElement("div"); // å»ºç«‹ä¸€å€‹æ ¼å­
        tile.className = "tile";
        tile.dataset.index = i;

        // é è¨­é»æ“Šå‹•ä½œï¼šåŠ å…¥å·²æ¢ç´¢æ ¼å­
        tile.onclick = () => {
          exploredTiles.add(i);
        };

        mapDiv.appendChild(tile);
      }

      // éš¨æ©Ÿé…ç½®æ€ªç‰©åœ¨åœ°åœ–ä¸Šï¼Œæœ€å¤šç´„15%æ©Ÿç‡å‡ºç¾
      for (let i = 0; i < 100; i++) {
        if (Math.random() < 0.15) {
          const tile = mapDiv.children[i]; // å–å¾—è©²æ ¼å­DOM
          const creature = creatures[Math.floor(Math.random() * creatures.length)];

          tile.textContent = creature.emoji; // é¡¯ç¤ºæ€ªç‰©
          tile.title = creature.name;        // æ»‘é¼ æç¤ºæ€ªç‰©å

          // è¨­å®šé»æ“Šäº‹ä»¶ï¼Œé»æ“Šæ€ªç‰©è§¸ç™¼ï¼š
          tile.onclick = () => {
            exploredTiles.add(i); // åŠ å…¥å·²æ¢ç´¢æ ¼å­
            if (!seen.has(creature.name)) {
              seen.add(creature.name); // æ–°ç™¼ç¾æ€ªç‰©åŠ å…¥seené›†åˆ
            }
            creature.seenCount++;      // è©²æ€ªç‰©å‡ºç¾æ¬¡æ•¸+1
            updateDex();              // æ›´æ–°åœ–é‘‘æ¸…å–®
            updateProgress();         // æ›´æ–°é€²åº¦æ¢
            playSound(creature.sound);// æ’­æ”¾æ€ªç‰©éŸ³æ•ˆ
            rareEffect.play();        // æ’­æ”¾ç¨€æœ‰éŸ³æ•ˆ
            speak(`å“‡ï½æ˜¯å‚³èªªä¸­çš„ ${creature.name}ï¼`);// èªéŸ³æ’­å ±

            // åœ°åœ–é‡æ–°ç”Ÿæˆï¼Œåˆ·æ–°æ€ªç‰©åˆ†å¸ƒä½ç½®
            generateMap();
          };

          creaturePositions.push(i); // è¨˜éŒ„è©²æ€ªç‰©ä½ç½®
        }
      }
    }

    generateMap(); // åˆå§‹åŒ–å‘¼å«ï¼Œç”Ÿæˆåœ°åœ–
  </script>
</body>
</html>